(()=>{var e={};e.id=501,e.ids=[501],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},2694:e=>{"use strict";e.exports=require("http2")},8791:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},5056:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>d,routeModule:()=>x,tree:()=>c}),t(4404),t(4223),t(5866);var a=t(3191),r=t(8716),l=t(7922),i=t.n(l),o=t(5231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);t.d(s,n);let c=["",{children:["[locale]",{children:["proposals",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4404)),"/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/proposals/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4223)),"/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/layout.tsx"]}]},{"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/proposals/page.tsx"],p="/[locale]/proposals/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/[locale]/proposals/page",pathname:"/[locale]/proposals",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8321:(e,s,t)=>{Promise.resolve().then(t.bind(t,6414))},6414:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var a=t(326),r=t(3071),l=t(1919),i=t(8853),o=t(4620),n=t(7577),c=t(3844);function d(){let e=(0,c.useTranslations)("pos");(0,c.useTranslations)("common");let s=(0,c.useLocale)(),[t,d]=(0,n.useState)("draft"),{data:p,isLoading:u,error:x}=(0,o.Wu)({status:t||void 0}),h=(0,o.V8)(),m=(0,o.dw)(),[g,j]=(0,n.useState)(null),[y,b]=(0,n.useState)(""),[v,f]=(0,n.useState)(""),[N,P]=(0,n.useState)(!1),[C,q]=(0,n.useState)(!1),_=(0,n.useMemo)(()=>new Intl.DateTimeFormat(s,{year:"numeric",month:"short",day:"numeric"}),[s]),I=(0,n.useMemo)(()=>new Intl.NumberFormat(s,{style:"currency",currency:"EUR"}),[s]),S=async()=>{if(g&&y)try{await h.mutateAsync({proposalId:g,legalEntityId:y}),P(!1),j(null),b("")}catch(e){console.error("Error converting proposal:",e)}},w=async()=>{if(g&&v)try{await m.mutateAsync({id:g,cancellationReason:v}),q(!1),j(null),f("")}catch(e){console.error("Error cancelling proposal:",e)}},k=e=>{j(e.id),P(!0)},L=e=>{j(e.id),q(!0)};return a.jsx(r.Z,{children:a.jsx(l.c,{roles:[i.K$.ADMIN,i.K$.RECEPTION,i.K$.CLINICAL_OPS,i.K$.ACCOUNTING],children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"page-header",children:[a.jsx("h1",{children:e("pos:title")}),(0,a.jsxs)("select",{value:t,onChange:e=>d(e.target.value),style:{padding:"8px 12px",border:"1px solid var(--gray-300)",borderRadius:"6px"},"aria-label":e("pos:filters.status"),children:[a.jsx("option",{value:"",children:e("pos:filters.allStatuses")}),a.jsx("option",{value:"draft",children:e("pos:proposal.status.draft")}),a.jsx("option",{value:"converted",children:e("pos:proposal.status.converted")}),a.jsx("option",{value:"cancelled",children:e("pos:proposal.status.cancelled")})]})]}),x&&(0,a.jsxs)("div",{className:"alert-error",children:[e("pos:errors.loadingFailed"),": ",x?.message||e("common:errors.generic")]}),u?a.jsx("div",{className:"card",children:a.jsx("div",{className:"card-body",children:e("common:status.loading")})}):a.jsx("div",{className:"card",children:(0,a.jsxs)("table",{className:"table",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:e("pos:table.date")}),a.jsx("th",{children:e("pos:table.patient")}),a.jsx("th",{children:e("pos:table.practitioner")}),a.jsx("th",{children:e("pos:table.items")}),a.jsx("th",{children:e("pos:table.total")}),a.jsx("th",{children:e("pos:table.status")}),a.jsx("th",{children:e("pos:table.actions")})]})}),a.jsx("tbody",{children:p?.results.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"32px"},children:e("pos:empty.noProposals")})}):p?.results.map(s=>a.jsxs("tr",{children:[a.jsx("td",{children:_.format(new Date(s.created_at))}),a.jsxs("td",{children:[a.jsx("div",{style:{fontWeight:500},children:s.patient.full_name}),a.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:s.patient.email})]}),a.jsx("td",{children:s.practitioner.display_name}),a.jsx("td",{children:e("pos:labels.items_other",{count:s.lines.length})}),a.jsx("td",{style:{fontWeight:500},children:I.format(Number(s.total_amount))}),a.jsx("td",{children:a.jsx("span",{className:`badge badge-${s.status}`,children:e(`pos:proposal.status.${s.status}`,s.status)})}),a.jsx("td",{children:a.jsxs("div",{className:"flex gap-2",children:["draft"===s.status&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>k(s),className:"btn-primary btn-sm",children:e("pos:actions.createSale")}),a.jsx("button",{onClick:()=>L(s),className:"btn-secondary btn-sm",style:{color:"var(--error)"},children:e("pos:actions.cancel")})]}),"converted"===s.status&&s.converted_to_sale_id&&a.jsx("a",{href:`/sales/${s.converted_to_sale_id}`,className:"btn-secondary btn-sm",style:{textDecoration:"none"},children:e("pos:actions.viewSale")})]})})]},s.id))})]})}),p&&p.results.length>0&&(0,a.jsxs)("div",{style:{marginTop:"16px",fontSize:"14px",color:"var(--gray-600)"},children:[e("pos:summary.totalProposals"),": ",p.count]}),N&&a.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>P(!1),children:(0,a.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[a.jsx("div",{className:"card-header",children:a.jsx("h2",{children:e("pos:modals.convertTitle")})}),(0,a.jsxs)("div",{className:"card-body",children:[a.jsx("p",{style:{marginBottom:"16px",color:"var(--gray-700)"},children:e("pos:modals.convertDescription")}),(0,a.jsxs)("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"legalEntityId",children:e("pos:modals.legalEntityLabel")}),a.jsx("input",{id:"legalEntityId",type:"text",value:y,onChange:e=>b(e.target.value),placeholder:e("pos:modals.legalEntityPlaceholder"),required:!0}),a.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)",marginTop:"4px"},children:e("pos:modals.legalEntityHelp")})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between",children:[a.jsx("button",{onClick:()=>P(!1),className:"btn-secondary",disabled:h.isPending,children:e("pos:actions.cancel")}),a.jsx("button",{onClick:S,className:"btn-primary",disabled:!y||h.isPending,children:h.isPending?e("pos:actions.converting"):e("pos:actions.createSale")})]})]})]})}),C&&a.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>q(!1),children:(0,a.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[a.jsx("div",{className:"card-header",children:a.jsx("h2",{children:e("pos:modals.cancelTitle")})}),(0,a.jsxs)("div",{className:"card-body",children:[a.jsx("p",{style:{marginBottom:"16px",color:"var(--error)",fontWeight:500},children:e("pos:modals.cancelDescription")}),(0,a.jsxs)("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"cancellationReason",children:e("pos:modals.cancellationReasonLabel")}),a.jsx("textarea",{id:"cancellationReason",value:v,onChange:e=>f(e.target.value),placeholder:e("pos:modals.cancellationReasonPlaceholder"),required:!0,rows:4})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between",children:[a.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",disabled:m.isPending,children:e("pos:actions.back")}),a.jsx("button",{onClick:w,className:"btn-destructive",disabled:!v||m.isPending,children:m.isPending?e("pos:actions.cancelling"):e("pos:modals.confirmCancel")})]})]})]})})]})})})}},1919:(e,s,t)=>{"use strict";t.d(s,{c:()=>l});var a=t(326),r=t(8853);function l({roles:e,children:s,fallback:t=null}){return(0,r.p5)(e)?a.jsx(a.Fragment,{children:s}):a.jsx(a.Fragment,{children:t})}},4620:(e,s,t)=>{"use strict";t.d(s,{NL:()=>d,V8:()=>p,Wu:()=>c,dw:()=>u});var a=t(108),r=t(4976),l=t(119),i=t(3002),o=t(5154);let n={all:["proposals"],lists:()=>[...n.all,"list"],list:e=>[...n.lists(),e],details:()=>[...n.all,"detail"],detail:e=>[...n.details(),e]};function c(e){return(0,a.a)({queryKey:n.list(e||{}),queryFn:async()=>(await i.ZP.get(o.q.CLINICAL.PROPOSALS,{params:e})).data})}function d(){let e=(0,r.NL)();return(0,l.D)({mutationFn:async({encounterId:e,notes:s})=>(await i.ZP.post(`${o.q.CLINICAL.ENCOUNTERS}${e}/generate-proposal/`,{notes:s})).data,onSuccess:()=>{e.invalidateQueries({queryKey:n.lists()})}})}function p(){let e=(0,r.NL)();return(0,l.D)({mutationFn:async({proposalId:e,legalEntityId:s,notes:t})=>(await i.ZP.post(`${o.q.CLINICAL.PROPOSALS}${e}/create-sale/`,{legal_entity_id:s,notes:t})).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:n.lists()}),e.invalidateQueries({queryKey:n.detail(t.proposalId)})}})}function u(){let e=(0,r.NL)();return(0,l.D)({mutationFn:async({id:e,reason:s})=>(await i.ZP.patch(`${o.q.CLINICAL.PROPOSALS}${e}/`,{status:"cancelled",cancellation_reason:s})).data,onSuccess:(s,t)=>{e.invalidateQueries({queryKey:n.lists()}),e.invalidateQueries({queryKey:n.detail(t.id)})}})}},4404:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(8570).createProxy)(String.raw`/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/proposals/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[276,49,364,420,80],()=>t(5056));module.exports=a})();