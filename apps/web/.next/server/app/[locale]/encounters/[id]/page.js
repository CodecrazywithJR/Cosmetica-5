(()=>{var e={};e.id=826,e.ids=[826],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},2694:e=>{"use strict";e.exports=require("http2")},8791:e=>{"use strict";e.exports=require("https")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},6162:e=>{"use strict";e.exports=require("stream")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},7729:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>r.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>o,routeModule:()=>h,tree:()=>d}),i(431),i(4223),i(5866);var s=i(3191),a=i(8716),n=i(7922),r=i.n(n),l=i(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);i.d(t,c);let d=["",{children:["[locale]",{children:["encounters",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,431)),"/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/encounters/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,4223)),"/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/layout.tsx"]}]},{"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/encounters/[id]/page.tsx"],u="/[locale]/encounters/[id]/page",p={require:i,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/[locale]/encounters/[id]/page",pathname:"/[locale]/encounters/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9649:(e,t,i)=>{Promise.resolve().then(i.bind(i,6645))},6645:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var s=i(326),a=i(3071),n=i(1919),r=i(8853),l=i(108),c=i(4976),d=i(119),o=i(3002),u=i(5154);let p={all:["encounters"],lists:()=>[...p.all,"list"],list:e=>[...p.lists(),e],details:()=>[...p.all,"detail"],detail:e=>[...p.details(),e]};var h=i(4620),x=i(5047),m=i(7577),y=i(3844),j=i(9105);function g(){let e=(0,y.useTranslations)("clinical");(0,y.useTranslations)("common");let t=(0,y.useLocale)(),i=(0,x.useParams)(),g=(0,x.useRouter)(),v=i.id,{data:b,isLoading:f,error:N}=(0,l.a)({queryKey:p.detail(v),queryFn:async()=>(await o.ZP.get(`${u.q.CLINICAL.ENCOUNTERS}${v}/`)).data,enabled:!!v}),P=function(){let e=(0,c.NL)();return(0,d.D)({mutationFn:async({encounterId:e,treatmentId:t,quantity:i,unitPrice:s,notes:a})=>(await o.ZP.post(`${u.q.CLINICAL.ENCOUNTERS}${e}/add_treatment/`,{treatment_id:t,quantity:i,unit_price:s,notes:a})).data,onSuccess:(t,i)=>{e.invalidateQueries({queryKey:p.detail(i.encounterId)})}})}(),C=function(){let e=(0,c.NL)();return(0,d.D)({mutationFn:async e=>(await o.ZP.patch(`${u.q.CLINICAL.ENCOUNTERS}${e}/`,{status:"finalized"})).data,onSuccess:(t,i)=>{e.invalidateQueries({queryKey:p.lists()}),e.invalidateQueries({queryKey:p.detail(i)})}})}(),q=(0,h.NL)(),[L,I]=(0,m.useState)(!1),[_,S]=(0,m.useState)(!1),[w,z]=(0,m.useState)(""),[k,A]=(0,m.useState)(1),[$,T]=(0,m.useState)(""),[F,E]=(0,m.useState)(""),D=(0,m.useMemo)(()=>new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),[t]),O=(0,m.useMemo)(()=>new Intl.NumberFormat(t,{style:"currency",currency:"USD"}),[t]),K=async()=>{if(w&&!(k<=0))try{await P.mutateAsync({encounterId:v,treatmentId:w,quantity:k,unitPrice:$?parseFloat($):void 0,notes:F||void 0}),I(!1),z(""),A(1),T(""),E("")}catch(e){console.error("Error adding treatment:",e)}},R=async()=>{try{await C.mutateAsync(v),S(!1)}catch(e){console.error("Error finalizing encounter:",e)}},W=async()=>{try{let i=await q.mutateAsync({encounterId:v});alert(`${e("clinical:messages.proposalGenerated")} ${i.proposal_id}`),g.push(j._.proposals.list(t))}catch(e){console.error("Error generating proposal:",e)}};return f?s.jsx(a.Z,{children:s.jsx("div",{className:"card",children:s.jsx("div",{className:"card-body",children:e("clinical:loading.encounter")})})}):N||!b?s.jsx(a.Z,{children:(0,s.jsxs)("div",{className:"alert-error",children:[e("clinical:errors.loadingFailed"),": ",N?.message||e("clinical:errors.notFound")]})}):s.jsx(a.Z,{children:s.jsx(n.c,{roles:[r.K$.ADMIN,r.K$.PRACTITIONER,r.K$.CLINICAL_OPS],children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"page-header",children:[s.jsx("h1",{children:e("clinical:encounter.title")}),s.jsx("span",{className:`badge badge-${b.status}`,children:e(`clinical:encounter.status.${b.status}`,b.status)})]}),(0,s.jsxs)("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h2",{children:e("clinical:sections.patientInfo")})}),s.jsx("div",{className:"card-body",children:(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:patientLabels.name")}),s.jsx("div",{style:{fontWeight:500},children:b.patient.full_name})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:patientLabels.email")}),s.jsx("div",{children:b.patient.email})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:patientLabels.phone")}),s.jsx("div",{children:b.patient.phone||"—"})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:patientLabels.dateOfBirth")}),s.jsx("div",{children:b.patient.birth_date||"—"})]})]})})]}),(0,s.jsxs)("div",{className:"card mb-4",children:[s.jsx("div",{className:"card-header",children:s.jsx("h2",{children:e("clinical:sections.encounterInfo")})}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.practitioner")}),s.jsx("div",{style:{fontWeight:500},children:b.practitioner?.display_name||"—"})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.type")}),s.jsx("div",{children:e(`clinical:encounter.type.${b.type.replace(/-/g,"_")}`,b.type)})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.date")}),s.jsx("div",{children:D.format(new Date(b.occurred_at))})]}),(0,s.jsxs)("div",{children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.status")}),s.jsx("div",{children:s.jsx("span",{className:`badge badge-${b.status}`,children:e(`clinical:encounter.status.${b.status}`,b.status)})})]})]}),b.chief_complaint&&(0,s.jsxs)("div",{style:{marginTop:"16px"},children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.chiefComplaint")}),s.jsx("div",{children:b.chief_complaint})]}),b.assessment&&(0,s.jsxs)("div",{style:{marginTop:"16px"},children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.assessment")}),s.jsx("div",{children:b.assessment})]}),b.plan&&(0,s.jsxs)("div",{style:{marginTop:"16px"},children:[s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:e("clinical:encounterLabels.plan")}),s.jsx("div",{children:b.plan})]})]})]}),(0,s.jsxs)("div",{className:"card mb-4",children:[(0,s.jsxs)("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("h2",{children:e("clinical:sections.treatments")}),"draft"===b.status&&s.jsx("button",{onClick:()=>I(!0),className:"btn-primary btn-sm",children:e("clinical:actions.addTreatment")})]}),s.jsx("div",{className:"card-body",style:{padding:0},children:b.encounter_treatments&&b.encounter_treatments.length>0?(0,s.jsxs)("table",{className:"table",children:[s.jsx("thead",{children:(0,s.jsxs)("tr",{children:[s.jsx("th",{children:e("clinical:treatmentLabels.treatment")}),s.jsx("th",{children:e("clinical:treatmentLabels.quantity")}),s.jsx("th",{children:e("clinical:treatmentLabels.unitPrice")}),s.jsx("th",{children:e("clinical:treatmentLabels.total")}),s.jsx("th",{children:e("clinical:treatmentLabels.notes")})]})}),s.jsx("tbody",{children:b.encounter_treatments.map(e=>(0,s.jsxs)("tr",{children:[s.jsx("td",{style:{fontWeight:500},children:e.treatment.name}),s.jsx("td",{children:e.quantity}),s.jsx("td",{children:O.format(Number(e.unit_price||e.effective_price))}),s.jsx("td",{style:{fontWeight:500},children:O.format(Number(e.total_price))}),s.jsx("td",{children:e.notes||"—"})]},e.id))})]}):s.jsx("div",{style:{padding:"32px",textAlign:"center",color:"var(--gray-600)"},children:e("clinical:empty.noTreatments")})})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:["draft"===b.status&&s.jsx("button",{onClick:()=>S(!0),className:"btn-primary",disabled:C.isPending||!b.encounter_treatments?.length,title:b.encounter_treatments?.length?"":e("clinical:messages.mustAddTreatments"),children:C.isPending?e("clinical:actions.finalizing"):e("clinical:actions.finalize")}),"finalized"===b.status&&s.jsx("button",{onClick:W,className:"btn-primary",disabled:q.isPending,children:q.isPending?e("clinical:actions.generating"):e("clinical:actions.generateProposal")}),s.jsx("button",{onClick:()=>g.back(),className:"btn-secondary",children:e("clinical:actions.back")})]}),L&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>I(!1),children:(0,s.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"card-header",children:s.jsx("h2",{children:e("clinical:modals.addTreatmentTitle")})}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsxs)("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"treatmentId",children:e("clinical:modals.treatmentIdLabel")}),s.jsx("input",{id:"treatmentId",type:"text",value:w,onChange:e=>z(e.target.value),placeholder:e("clinical:modals.treatmentIdPlaceholder"),required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"quantity",children:e("clinical:modals.quantityLabel")}),s.jsx("input",{id:"quantity",type:"number",min:"1",value:k,onChange:e=>A(parseInt(e.target.value)),required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"unitPrice",children:e("clinical:modals.unitPriceLabel")}),s.jsx("input",{id:"unitPrice",type:"number",step:"0.01",value:$,onChange:e=>T(e.target.value),placeholder:e("clinical:modals.unitPricePlaceholder")})]}),(0,s.jsxs)("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"notes",children:e("clinical:modals.notesLabel")}),s.jsx("textarea",{id:"notes",value:F,onChange:e=>E(e.target.value),rows:3,placeholder:e("clinical:modals.notesPlaceholder")})]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-between",children:[s.jsx("button",{onClick:()=>I(!1),className:"btn-secondary",disabled:P.isPending,children:e("clinical:actions.cancel")}),s.jsx("button",{onClick:K,className:"btn-primary",disabled:!w||k<=0||P.isPending,children:P.isPending?e("clinical:actions.adding"):e("clinical:actions.add")})]})]})]})}),_&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>S(!1),children:(0,s.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"card-header",children:s.jsx("h2",{children:e("clinical:modals.finalizeTitle")})}),(0,s.jsxs)("div",{className:"card-body",children:[s.jsx("p",{style:{marginBottom:"12px",fontWeight:500,color:"var(--warning)"},children:e("clinical:modals.finalizeWarning")}),s.jsx("p",{style:{marginBottom:"12px",color:"var(--gray-700)"},children:e("clinical:modals.finalizeDescription")}),s.jsx("p",{style:{marginBottom:"16px",color:"var(--error)",fontWeight:500},children:e("clinical:modals.finalizeIrreversible")}),(0,s.jsxs)("div",{className:"flex gap-2 justify-between",children:[s.jsx("button",{onClick:()=>S(!1),className:"btn-secondary",disabled:C.isPending,children:e("clinical:actions.cancel")}),s.jsx("button",{onClick:R,className:"btn-primary",disabled:C.isPending,children:C.isPending?e("clinical:actions.finalizing"):e("clinical:modals.confirmFinalize")})]})]})]})})]})})})}},1919:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});var s=i(326),a=i(8853);function n({roles:e,children:t,fallback:i=null}){return(0,a.p5)(e)?s.jsx(s.Fragment,{children:t}):s.jsx(s.Fragment,{children:i})}},4620:(e,t,i)=>{"use strict";i.d(t,{NL:()=>o,V8:()=>u,Wu:()=>d,dw:()=>p});var s=i(108),a=i(4976),n=i(119),r=i(3002),l=i(5154);let c={all:["proposals"],lists:()=>[...c.all,"list"],list:e=>[...c.lists(),e],details:()=>[...c.all,"detail"],detail:e=>[...c.details(),e]};function d(e){return(0,s.a)({queryKey:c.list(e||{}),queryFn:async()=>(await r.ZP.get(l.q.CLINICAL.PROPOSALS,{params:e})).data})}function o(){let e=(0,a.NL)();return(0,n.D)({mutationFn:async({encounterId:e,notes:t})=>(await r.ZP.post(`${l.q.CLINICAL.ENCOUNTERS}${e}/generate-proposal/`,{notes:t})).data,onSuccess:()=>{e.invalidateQueries({queryKey:c.lists()})}})}function u(){let e=(0,a.NL)();return(0,n.D)({mutationFn:async({proposalId:e,legalEntityId:t,notes:i})=>(await r.ZP.post(`${l.q.CLINICAL.PROPOSALS}${e}/create-sale/`,{legal_entity_id:t,notes:i})).data,onSuccess:(t,i)=>{e.invalidateQueries({queryKey:c.lists()}),e.invalidateQueries({queryKey:c.detail(i.proposalId)})}})}function p(){let e=(0,a.NL)();return(0,n.D)({mutationFn:async({id:e,reason:t})=>(await r.ZP.patch(`${l.q.CLINICAL.PROPOSALS}${e}/`,{status:"cancelled",cancellation_reason:t})).data,onSuccess:(t,i)=>{e.invalidateQueries({queryKey:c.lists()}),e.invalidateQueries({queryKey:c.detail(i.id)})}})}},431:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});let s=(0,i(8570).createProxy)(String.raw`/Users/josericardoparlonsebastian/Desktop/Ideas/Cosmetica 5/apps/web/src/app/[locale]/encounters/[id]/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[276,49,364,420,80],()=>i(7729));module.exports=s})();