"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{2778:function(e,t,a){a.d(t,{Z:function(){return h}});var o=a(7437);a(2265);var n=a(7766),r=a(9376),s=a(2586),l=a(7648);let c=["en","ru","fr","uk","hy","es"],i={en:"English",ru:"Русский",uk:"Українська",hy:"Հայերեն",fr:"Fran\xe7ais",es:"Espa\xf1ol"};function u(){let e=(0,s.useLocale)(),t=(0,r.useRouter)(),a=(0,r.usePathname)(),n=(0,s.useTranslations)("common");return(0,o.jsxs)("div",{className:"language-switcher",children:[(0,o.jsx)("label",{htmlFor:"language-select",className:"language-label",children:n("languageLabel")}),(0,o.jsx)("select",{id:"language-select",value:e,onChange:o=>{let n=o.target.value,r=a.replace("/".concat(e),"");t.push("/".concat(n).concat(r||""))},className:"language-select",children:c.map(e=>(0,o.jsx)("option",{value:e,children:i[e]},e))})]})}var d=a(1848);function h(e){let{children:t}=e,{user:a,logout:c,hasAnyRole:i}=(0,n.aC)(),h=(0,r.usePathname)(),I=(0,r.useRouter)(),j=(0,s.useTranslations)("nav"),x=(0,s.useTranslations)("common"),E=(0,s.useLocale)();if(!a)return I.push(d._.login(E)),null;let S=[{name:j("agenda"),href:d._.agenda(E),icon:m,show:i([n.K$.ADMIN,n.K$.RECEPTION,n.K$.PRACTITIONER])},{name:j("schedule"),href:d._.schedule(E),icon:p,show:i([n.K$.ADMIN,n.K$.RECEPTION,n.K$.PRACTITIONER])},{name:j("patients"),href:d._.patients.list(E),icon:v,show:i([n.K$.ADMIN,n.K$.RECEPTION,n.K$.PRACTITIONER])},{name:j("encounters"),href:d._.encounters.list(E),icon:f,show:i([n.K$.ADMIN,n.K$.PRACTITIONER])},{name:j("proposals"),href:d._.proposals.list(E),icon:g,show:i([n.K$.ADMIN,n.K$.RECEPTION,n.K$.ACCOUNTING])},{name:j("sales"),href:d._.sales.list(E),icon:N,show:i([n.K$.ADMIN,n.K$.RECEPTION,n.K$.ACCOUNTING])},{name:j("admin"),href:d._.admin(E),icon:k,show:i([n.K$.ADMIN])}];return(0,o.jsxs)("div",{className:"app-layout",children:[(0,o.jsxs)("aside",{className:"sidebar",children:[(0,o.jsxs)("div",{className:"sidebar-header",children:[(0,o.jsx)("h2",{children:"Cosmetica 5"}),(0,o.jsxs)("div",{className:"user-info",children:[(0,o.jsx)("span",{className:"user-name",children:a.email||x("user")}),(0,o.jsx)("span",{className:"user-roles",children:a.roles.join(", ")})]})]}),(0,o.jsx)("nav",{className:"sidebar-menu",children:S.filter(e=>e.show).map(e=>{let t=h===e.href||(null==h?void 0:h.startsWith(e.href+"/"));return(0,o.jsxs)(l.default,{href:e.href,className:"sidebar-item ".concat(t?"active":""),children:[(0,o.jsx)(e.icon,{className:"sidebar-icon"}),(0,o.jsx)("span",{children:e.name})]},e.name)})}),(0,o.jsxs)("div",{className:"sidebar-footer",children:[(0,o.jsx)(u,{}),(0,o.jsx)("button",{onClick:c,className:"btn-secondary w-full",style:{marginTop:"12px"},children:j("actions.logout")})]})]}),(0,o.jsx)("main",{className:"main-content",children:t})]})}function m(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}function p(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}function v(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}function f(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}function g(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}function N(e){let{className:t}=e;return(0,o.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})})}function k(e){let{className:t}=e;return(0,o.jsxs)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}},3227:function(e,t,a){var o=a(3464),n=a(1290);let r="http://localhost:8000",s=o.Z.create({baseURL:r,headers:{"Content-Type":"application/json"},timeout:3e4}),l=!1,c=[],i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c.forEach(a=>{e?a.reject(e):a.resolve(t)}),c=[]},u=()=>{let e=window.location.pathname.split("/").filter(Boolean);return["en","es","fr","ru","uk","hy"].includes(e[0])?e[0]:"en"};s.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");if(t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e.headers){let t=u();e.headers["Accept-Language"]=t}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let a=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!a._retry){let e=localStorage.getItem("refresh_token");if(e){if(l)return new Promise((e,t)=>{c.push({resolve:e,reject:t})}).then(e=>(a.headers&&(a.headers.Authorization="Bearer ".concat(e)),s(a))).catch(e=>Promise.reject(e));a._retry=!0,l=!0;try{let{access:t}=(await o.Z.post("".concat(r).concat(n.q.AUTH.REFRESH),{refresh:e})).data;return localStorage.setItem("access_token",t),a.headers&&(a.headers.Authorization="Bearer ".concat(t)),i(null,t),l=!1,s(a)}catch(e){i(e,null),l=!1;{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}return Promise.reject(e)}}else{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}}return Promise.reject(e)}),t.ZP=s},1290:function(e,t,a){a.d(t,{q:function(){return o}});let o={AUTH:{TOKEN:"/api/auth/token/",REFRESH:"/api/auth/token/refresh/",ME:"/api/auth/me/"},CLINICAL:{APPOINTMENTS:"/api/v1/clinical/appointments/",PATIENTS:"/api/v1/clinical/patients/",ENCOUNTERS:"/api/v1/clinical/encounters/",TREATMENTS:"/api/v1/clinical/treatments/",PROPOSALS:"/api/v1/clinical/proposals/"},POS:{SALES:"/api/v1/pos/sales/"}}},7766:function(e,t,a){a.d(t,{Ho:function(){return i},K$:function(){return h},aC:function(){return u},p5:function(){return d}});var o=a(7437),n=a(2265),r=a(9376),s=a(3227),l=a(1290);let c=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),h=(0,r.useRouter)();(0,n.useEffect)(()=>{(async()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("access_token");if(e&&t)try{let t=JSON.parse(e);i(t);try{let e=(await s.ZP.get(l.q.AUTH.ME)).data;localStorage.setItem("user",JSON.stringify(e)),i(e)}catch(e){console.error("Failed to refresh user profile:",e)}}catch(e){console.error("Failed to parse stored user:",e),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}d(!1)})()},[]);let m=async(e,t)=>{try{let{access:a,refresh:o}=(await s.ZP.post(l.q.AUTH.TOKEN,{email:e,password:t})).data;if(!a||!o)throw Error("Invalid token response from server");localStorage.setItem("access_token",a),localStorage.setItem("refresh_token",o);let n=(await s.ZP.get(l.q.AUTH.ME)).data;localStorage.setItem("user",JSON.stringify(n)),i(n)}catch(e){var a,o,n,r,c;throw localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null),Error((null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.detail)||(null===(c=e.response)||void 0===c?void 0:null===(r=c.data)||void 0===r?void 0:null===(n=r.error)||void 0===n?void 0:n.message)||"Login failed. Please check your credentials.")}},p=e=>{var t,o;return null!==(o=null==a?void 0:null===(t=a.roles)||void 0===t?void 0:t.includes(e))&&void 0!==o&&o};return(0,o.jsx)(c.Provider,{value:{user:a,isLoading:u,isAuthenticated:!!a,login:m,logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null);let e=window.location.pathname.split("/")[1]||"en";h.push("/".concat(e,"/login"))},hasRole:p,hasAnyRole:e=>e.some(e=>p(e))},children:t})}function u(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{hasAnyRole:t}=u();return t(e)}let h={ADMIN:"admin",PRACTITIONER:"practitioner",RECEPTION:"reception",MARKETING:"marketing",ACCOUNTING:"accounting"}},1848:function(e,t,a){a.d(t,{_:function(){return o}});let o={dashboard:e=>"/".concat(e),agenda:e=>"/".concat(e),schedule:e=>"/".concat(e,"/schedule"),encounters:{list:e=>"/".concat(e,"/encounters"),detail:(e,t)=>"/".concat(e,"/encounters/").concat(t)},proposals:{list:e=>"/".concat(e,"/proposals")},login:e=>"/".concat(e,"/login"),patients:{list:e=>"/".concat(e,"/patients"),detail:(e,t)=>"/".concat(e,"/patients/").concat(t)},sales:{list:e=>"/".concat(e,"/sales")},admin:e=>"/".concat(e,"/admin")}}}]);