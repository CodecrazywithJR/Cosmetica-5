(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{8185:function(e,i,n){Promise.resolve().then(n.bind(n,1017))},1017:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return v}});var t=n(7437),a=n(2778),l=n(5995),s=n(7766),c=n(1713),r=n(9827),d=n(1770),o=n(3227),u=n(1290);let h={all:["encounters"],lists:()=>[...h.all,"list"],list:e=>[...h.lists(),e],details:()=>[...h.all,"detail"],detail:e=>[...h.details(),e]};var m=n(6178),x=n(9376),p=n(2265),y=n(2586),j=n(1848);function v(){var e,i,n;let v=(0,y.useTranslations)("clinical");(0,y.useTranslations)("common");let g=(0,y.useLocale)(),f=(0,x.useParams)(),b=(0,x.useRouter)(),N=f.id,{data:C,isLoading:L,error:P}=(0,c.a)({queryKey:h.detail(N),queryFn:async()=>(await o.ZP.get("".concat(u.q.CLINICAL.ENCOUNTERS).concat(N,"/"))).data,enabled:!!N}),I=function(){let e=(0,r.NL)();return(0,d.D)({mutationFn:async e=>{let{encounterId:i,treatmentId:n,quantity:t,unitPrice:a,notes:l}=e;return(await o.ZP.post("".concat(u.q.CLINICAL.ENCOUNTERS).concat(i,"/add_treatment/"),{treatment_id:n,quantity:t,unit_price:a,notes:l})).data},onSuccess:(i,n)=>{e.invalidateQueries({queryKey:h.detail(n.encounterId)})}})}(),S=function(){let e=(0,r.NL)();return(0,d.D)({mutationFn:async e=>(await o.ZP.patch("".concat(u.q.CLINICAL.ENCOUNTERS).concat(e,"/"),{status:"finalized"})).data,onSuccess:(i,n)=>{e.invalidateQueries({queryKey:h.lists()}),e.invalidateQueries({queryKey:h.detail(n)})}})}(),_=(0,m.NL)(),[q,z]=(0,p.useState)(!1),[w,k]=(0,p.useState)(!1),[T,F]=(0,p.useState)(""),[A,E]=(0,p.useState)(1),[O,K]=(0,p.useState)(""),[D,R]=(0,p.useState)(""),W=(0,p.useMemo)(()=>new Intl.DateTimeFormat(g,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),[g]),Z=(0,p.useMemo)(()=>new Intl.NumberFormat(g,{style:"currency",currency:"USD"}),[g]),Q=async()=>{if(T&&!(A<=0))try{await I.mutateAsync({encounterId:N,treatmentId:T,quantity:A,unitPrice:O?parseFloat(O):void 0,notes:D||void 0}),z(!1),F(""),E(1),K(""),R("")}catch(e){console.error("Error adding treatment:",e)}},U=async()=>{try{await S.mutateAsync(N),k(!1)}catch(e){console.error("Error finalizing encounter:",e)}},B=async()=>{try{let e=await _.mutateAsync({encounterId:N});alert("".concat(v("clinical:messages.proposalGenerated")," ").concat(e.proposal_id)),b.push(j._.proposals.list(g))}catch(e){console.error("Error generating proposal:",e)}};return L?(0,t.jsx)(a.Z,{children:(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:v("clinical:loading.encounter")})})}):P||!C?(0,t.jsx)(a.Z,{children:(0,t.jsxs)("div",{className:"alert-error",children:[v("clinical:errors.loadingFailed"),": ",(null==P?void 0:P.message)||v("clinical:errors.notFound")]})}):(0,t.jsx)(a.Z,{children:(0,t.jsx)(l.c,{roles:[s.K$.ADMIN,s.K$.PRACTITIONER,s.K$.CLINICAL_OPS],children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"page-header",children:[(0,t.jsx)("h1",{children:v("clinical:encounter.title")}),(0,t.jsx)("span",{className:"badge badge-".concat(C.status),children:v("clinical:encounter.status.".concat(C.status),C.status)})]}),(0,t.jsxs)("div",{className:"card mb-4",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{children:v("clinical:sections.patientInfo")})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:patientLabels.name")}),(0,t.jsx)("div",{style:{fontWeight:500},children:C.patient.full_name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:patientLabels.email")}),(0,t.jsx)("div",{children:C.patient.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:patientLabels.phone")}),(0,t.jsx)("div",{children:C.patient.phone||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:patientLabels.dateOfBirth")}),(0,t.jsx)("div",{children:C.patient.birth_date||"—"})]})]})})]}),(0,t.jsxs)("div",{className:"card mb-4",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{children:v("clinical:sections.encounterInfo")})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.practitioner")}),(0,t.jsx)("div",{style:{fontWeight:500},children:(null===(e=C.practitioner)||void 0===e?void 0:e.display_name)||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.type")}),(0,t.jsx)("div",{children:v("clinical:encounter.type.".concat(C.type.replace(/-/g,"_")),C.type)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.date")}),(0,t.jsx)("div",{children:W.format(new Date(C.occurred_at))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.status")}),(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:"badge badge-".concat(C.status),children:v("clinical:encounter.status.".concat(C.status),C.status)})})]})]}),C.chief_complaint&&(0,t.jsxs)("div",{style:{marginTop:"16px"},children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.chiefComplaint")}),(0,t.jsx)("div",{children:C.chief_complaint})]}),C.assessment&&(0,t.jsxs)("div",{style:{marginTop:"16px"},children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.assessment")}),(0,t.jsx)("div",{children:C.assessment})]}),C.plan&&(0,t.jsxs)("div",{style:{marginTop:"16px"},children:[(0,t.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:v("clinical:encounterLabels.plan")}),(0,t.jsx)("div",{children:C.plan})]})]})]}),(0,t.jsxs)("div",{className:"card mb-4",children:[(0,t.jsxs)("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("h2",{children:v("clinical:sections.treatments")}),"draft"===C.status&&(0,t.jsx)("button",{onClick:()=>z(!0),className:"btn-primary btn-sm",children:v("clinical:actions.addTreatment")})]}),(0,t.jsx)("div",{className:"card-body",style:{padding:0},children:C.encounter_treatments&&C.encounter_treatments.length>0?(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:v("clinical:treatmentLabels.treatment")}),(0,t.jsx)("th",{children:v("clinical:treatmentLabels.quantity")}),(0,t.jsx)("th",{children:v("clinical:treatmentLabels.unitPrice")}),(0,t.jsx)("th",{children:v("clinical:treatmentLabels.total")}),(0,t.jsx)("th",{children:v("clinical:treatmentLabels.notes")})]})}),(0,t.jsx)("tbody",{children:C.encounter_treatments.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{fontWeight:500},children:e.treatment.name}),(0,t.jsx)("td",{children:e.quantity}),(0,t.jsx)("td",{children:Z.format(Number(e.unit_price||e.effective_price))}),(0,t.jsx)("td",{style:{fontWeight:500},children:Z.format(Number(e.total_price))}),(0,t.jsx)("td",{children:e.notes||"—"})]},e.id))})]}):(0,t.jsx)("div",{style:{padding:"32px",textAlign:"center",color:"var(--gray-600)"},children:v("clinical:empty.noTreatments")})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:["draft"===C.status&&(0,t.jsx)("button",{onClick:()=>k(!0),className:"btn-primary",disabled:S.isPending||!(null===(i=C.encounter_treatments)||void 0===i?void 0:i.length),title:(null===(n=C.encounter_treatments)||void 0===n?void 0:n.length)?"":v("clinical:messages.mustAddTreatments"),children:S.isPending?v("clinical:actions.finalizing"):v("clinical:actions.finalize")}),"finalized"===C.status&&(0,t.jsx)("button",{onClick:B,className:"btn-primary",disabled:_.isPending,children:_.isPending?v("clinical:actions.generating"):v("clinical:actions.generateProposal")}),(0,t.jsx)("button",{onClick:()=>b.back(),className:"btn-secondary",children:v("clinical:actions.back")})]}),q&&(0,t.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>z(!1),children:(0,t.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{children:v("clinical:modals.addTreatmentTitle")})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"treatmentId",children:v("clinical:modals.treatmentIdLabel")}),(0,t.jsx)("input",{id:"treatmentId",type:"text",value:T,onChange:e=>F(e.target.value),placeholder:v("clinical:modals.treatmentIdPlaceholder"),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"quantity",children:v("clinical:modals.quantityLabel")}),(0,t.jsx)("input",{id:"quantity",type:"number",min:"1",value:A,onChange:e=>E(parseInt(e.target.value)),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"unitPrice",children:v("clinical:modals.unitPriceLabel")}),(0,t.jsx)("input",{id:"unitPrice",type:"number",step:"0.01",value:O,onChange:e=>K(e.target.value),placeholder:v("clinical:modals.unitPricePlaceholder")})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"notes",children:v("clinical:modals.notesLabel")}),(0,t.jsx)("textarea",{id:"notes",value:D,onChange:e=>R(e.target.value),rows:3,placeholder:v("clinical:modals.notesPlaceholder")})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-between",children:[(0,t.jsx)("button",{onClick:()=>z(!1),className:"btn-secondary",disabled:I.isPending,children:v("clinical:actions.cancel")}),(0,t.jsx)("button",{onClick:Q,className:"btn-primary",disabled:!T||A<=0||I.isPending,children:I.isPending?v("clinical:actions.adding"):v("clinical:actions.add")})]})]})]})}),w&&(0,t.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>k(!1),children:(0,t.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h2",{children:v("clinical:modals.finalizeTitle")})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("p",{style:{marginBottom:"12px",fontWeight:500,color:"var(--warning)"},children:v("clinical:modals.finalizeWarning")}),(0,t.jsx)("p",{style:{marginBottom:"12px",color:"var(--gray-700)"},children:v("clinical:modals.finalizeDescription")}),(0,t.jsx)("p",{style:{marginBottom:"16px",color:"var(--error)",fontWeight:500},children:v("clinical:modals.finalizeIrreversible")}),(0,t.jsxs)("div",{className:"flex gap-2 justify-between",children:[(0,t.jsx)("button",{onClick:()=>k(!1),className:"btn-secondary",disabled:S.isPending,children:v("clinical:actions.cancel")}),(0,t.jsx)("button",{onClick:U,className:"btn-primary",disabled:S.isPending,children:S.isPending?v("clinical:actions.finalizing"):v("clinical:modals.confirmFinalize")})]})]})]})})]})})})}},5995:function(e,i,n){"use strict";n.d(i,{c:function(){return l}});var t=n(7437),a=n(7766);function l(e){let{roles:i,children:n,fallback:l=null}=e;return(0,a.p5)(i)?(0,t.jsx)(t.Fragment,{children:n}):(0,t.jsx)(t.Fragment,{children:l})}},6178:function(e,i,n){"use strict";n.d(i,{NL:function(){return o},V8:function(){return u},Wu:function(){return d},dw:function(){return h}});var t=n(1713),a=n(9827),l=n(1770),s=n(3227),c=n(1290);let r={all:["proposals"],lists:()=>[...r.all,"list"],list:e=>[...r.lists(),e],details:()=>[...r.all,"detail"],detail:e=>[...r.details(),e]};function d(e){return(0,t.a)({queryKey:r.list(e||{}),queryFn:async()=>(await s.ZP.get(c.q.CLINICAL.PROPOSALS,{params:e})).data})}function o(){let e=(0,a.NL)();return(0,l.D)({mutationFn:async e=>{let{encounterId:i,notes:n}=e;return(await s.ZP.post("".concat(c.q.CLINICAL.ENCOUNTERS).concat(i,"/generate-proposal/"),{notes:n})).data},onSuccess:()=>{e.invalidateQueries({queryKey:r.lists()})}})}function u(){let e=(0,a.NL)();return(0,l.D)({mutationFn:async e=>{let{proposalId:i,legalEntityId:n,notes:t}=e;return(await s.ZP.post("".concat(c.q.CLINICAL.PROPOSALS).concat(i,"/create-sale/"),{legal_entity_id:n,notes:t})).data},onSuccess:(i,n)=>{e.invalidateQueries({queryKey:r.lists()}),e.invalidateQueries({queryKey:r.detail(n.proposalId)})}})}function h(){let e=(0,a.NL)();return(0,l.D)({mutationFn:async e=>{let{id:i,reason:n}=e;return(await s.ZP.patch("".concat(c.q.CLINICAL.PROPOSALS).concat(i,"/"),{status:"cancelled",cancellation_reason:n})).data},onSuccess:(i,n)=>{e.invalidateQueries({queryKey:r.lists()}),e.invalidateQueries({queryKey:r.detail(n.id)})}})}}},function(e){e.O(0,[618,586,954,364,778,971,117,744],function(){return e(e.s=8185)}),_N_E=e.O()}]);