(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{9509:function(e,t,s){Promise.resolve().then(s.bind(s,7906))},7906:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(7437),n=s(2778),l=s(5995),r=s(7766),i=s(6178),o=s(2265),c=s(2586);function d(){let e=(0,c.useTranslations)("pos");(0,c.useTranslations)("common");let t=(0,c.useLocale)(),[s,d]=(0,o.useState)("draft"),{data:u,isLoading:p,error:h}=(0,i.Wu)({status:s||void 0}),x=(0,i.V8)(),m=(0,i.dw)(),[j,y]=(0,o.useState)(null),[g,v]=(0,o.useState)(""),[b,f]=(0,o.useState)(""),[N,C]=(0,o.useState)(!1),[P,S]=(0,o.useState)(!1),I=(0,o.useMemo)(()=>new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"numeric"}),[t]),_=(0,o.useMemo)(()=>new Intl.NumberFormat(t,{style:"currency",currency:"EUR"}),[t]),L=async()=>{if(j&&g)try{await x.mutateAsync({proposalId:j,legalEntityId:g}),C(!1),y(null),v("")}catch(e){console.error("Error converting proposal:",e)}},w=async()=>{if(j&&b)try{await m.mutateAsync({id:j,cancellationReason:b}),S(!1),y(null),f("")}catch(e){console.error("Error cancelling proposal:",e)}},k=e=>{y(e.id),C(!0)},E=e=>{y(e.id),S(!0)};return(0,a.jsx)(n.Z,{children:(0,a.jsx)(l.c,{roles:[r.K$.ADMIN,r.K$.RECEPTION,r.K$.CLINICAL_OPS,r.K$.ACCOUNTING],children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"page-header",children:[(0,a.jsx)("h1",{children:e("pos:title")}),(0,a.jsxs)("select",{value:s,onChange:e=>d(e.target.value),style:{padding:"8px 12px",border:"1px solid var(--gray-300)",borderRadius:"6px"},"aria-label":e("pos:filters.status"),children:[(0,a.jsx)("option",{value:"",children:e("pos:filters.allStatuses")}),(0,a.jsx)("option",{value:"draft",children:e("pos:proposal.status.draft")}),(0,a.jsx)("option",{value:"converted",children:e("pos:proposal.status.converted")}),(0,a.jsx)("option",{value:"cancelled",children:e("pos:proposal.status.cancelled")})]})]}),h&&(0,a.jsxs)("div",{className:"alert-error",children:[e("pos:errors.loadingFailed"),": ",(null==h?void 0:h.message)||e("common:errors.generic")]}),p?(0,a.jsx)("div",{className:"card",children:(0,a.jsx)("div",{className:"card-body",children:e("common:status.loading")})}):(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:e("pos:table.date")}),(0,a.jsx)("th",{children:e("pos:table.patient")}),(0,a.jsx)("th",{children:e("pos:table.practitioner")}),(0,a.jsx)("th",{children:e("pos:table.items")}),(0,a.jsx)("th",{children:e("pos:table.total")}),(0,a.jsx)("th",{children:e("pos:table.status")}),(0,a.jsx)("th",{children:e("pos:table.actions")})]})}),(0,a.jsx)("tbody",{children:(null==u?void 0:u.results.length)===0?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,style:{textAlign:"center",padding:"32px"},children:e("pos:empty.noProposals")})}):null==u?void 0:u.results.map(t=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:I.format(new Date(t.created_at))}),(0,a.jsxs)("td",{children:[(0,a.jsx)("div",{style:{fontWeight:500},children:t.patient.full_name}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)"},children:t.patient.email})]}),(0,a.jsx)("td",{children:t.practitioner.display_name}),(0,a.jsx)("td",{children:e("pos:labels.items_other",{count:t.lines.length})}),(0,a.jsx)("td",{style:{fontWeight:500},children:_.format(Number(t.total_amount))}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge badge-".concat(t.status),children:e("pos:proposal.status.".concat(t.status),t.status)})}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"flex gap-2",children:["draft"===t.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>k(t),className:"btn-primary btn-sm",children:e("pos:actions.createSale")}),(0,a.jsx)("button",{onClick:()=>E(t),className:"btn-secondary btn-sm",style:{color:"var(--error)"},children:e("pos:actions.cancel")})]}),"converted"===t.status&&t.converted_to_sale_id&&(0,a.jsx)("a",{href:"/sales/".concat(t.converted_to_sale_id),className:"btn-secondary btn-sm",style:{textDecoration:"none"},children:e("pos:actions.viewSale")})]})})]},t.id))})]})}),u&&u.results.length>0&&(0,a.jsxs)("div",{style:{marginTop:"16px",fontSize:"14px",color:"var(--gray-600)"},children:[e("pos:summary.totalProposals"),": ",u.count]}),N&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>C(!1),children:(0,a.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h2",{children:e("pos:modals.convertTitle")})}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsx)("p",{style:{marginBottom:"16px",color:"var(--gray-700)"},children:e("pos:modals.convertDescription")}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"legalEntityId",children:e("pos:modals.legalEntityLabel")}),(0,a.jsx)("input",{id:"legalEntityId",type:"text",value:g,onChange:e=>v(e.target.value),placeholder:e("pos:modals.legalEntityPlaceholder"),required:!0}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"var(--gray-600)",marginTop:"4px"},children:e("pos:modals.legalEntityHelp")})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between",children:[(0,a.jsx)("button",{onClick:()=>C(!1),className:"btn-secondary",disabled:x.isPending,children:e("pos:actions.cancel")}),(0,a.jsx)("button",{onClick:L,className:"btn-primary",disabled:!g||x.isPending,children:x.isPending?e("pos:actions.converting"):e("pos:actions.createSale")})]})]})]})}),P&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>S(!1),children:(0,a.jsxs)("div",{className:"card",style:{width:"500px",maxWidth:"90%"},onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"card-header",children:(0,a.jsx)("h2",{children:e("pos:modals.cancelTitle")})}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsx)("p",{style:{marginBottom:"16px",color:"var(--error)",fontWeight:500},children:e("pos:modals.cancelDescription")}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"cancellationReason",children:e("pos:modals.cancellationReasonLabel")}),(0,a.jsx)("textarea",{id:"cancellationReason",value:b,onChange:e=>f(e.target.value),placeholder:e("pos:modals.cancellationReasonPlaceholder"),required:!0,rows:4})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between",children:[(0,a.jsx)("button",{onClick:()=>S(!1),className:"btn-secondary",disabled:m.isPending,children:e("pos:actions.back")}),(0,a.jsx)("button",{onClick:w,className:"btn-destructive",disabled:!b||m.isPending,children:m.isPending?e("pos:actions.cancelling"):e("pos:modals.confirmCancel")})]})]})]})})]})})})}},5995:function(e,t,s){"use strict";s.d(t,{c:function(){return l}});var a=s(7437),n=s(7766);function l(e){let{roles:t,children:s,fallback:l=null}=e;return(0,n.p5)(t)?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)(a.Fragment,{children:l})}},6178:function(e,t,s){"use strict";s.d(t,{NL:function(){return d},V8:function(){return u},Wu:function(){return c},dw:function(){return p}});var a=s(1713),n=s(9827),l=s(1770),r=s(3227),i=s(1290);let o={all:["proposals"],lists:()=>[...o.all,"list"],list:e=>[...o.lists(),e],details:()=>[...o.all,"detail"],detail:e=>[...o.details(),e]};function c(e){return(0,a.a)({queryKey:o.list(e||{}),queryFn:async()=>(await r.ZP.get(i.q.CLINICAL.PROPOSALS,{params:e})).data})}function d(){let e=(0,n.NL)();return(0,l.D)({mutationFn:async e=>{let{encounterId:t,notes:s}=e;return(await r.ZP.post("".concat(i.q.CLINICAL.ENCOUNTERS).concat(t,"/generate-proposal/"),{notes:s})).data},onSuccess:()=>{e.invalidateQueries({queryKey:o.lists()})}})}function u(){let e=(0,n.NL)();return(0,l.D)({mutationFn:async e=>{let{proposalId:t,legalEntityId:s,notes:a}=e;return(await r.ZP.post("".concat(i.q.CLINICAL.PROPOSALS).concat(t,"/create-sale/"),{legal_entity_id:s,notes:a})).data},onSuccess:(t,s)=>{e.invalidateQueries({queryKey:o.lists()}),e.invalidateQueries({queryKey:o.detail(s.proposalId)})}})}function p(){let e=(0,n.NL)();return(0,l.D)({mutationFn:async e=>{let{id:t,reason:s}=e;return(await r.ZP.patch("".concat(i.q.CLINICAL.PROPOSALS).concat(t,"/"),{status:"cancelled",cancellation_reason:s})).data},onSuccess:(t,s)=>{e.invalidateQueries({queryKey:o.lists()}),e.invalidateQueries({queryKey:o.detail(s.id)})}})}}},function(e){e.O(0,[618,586,954,364,778,971,117,744],function(){return e(e.s=9509)}),_N_E=e.O()}]);