(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{2513:function(e,t,r){Promise.resolve().then(r.bind(r,8807))},8807:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var o=r(7437),a=r(7766);r(1290),r(3227);var n=r(2265);function l(){let{user:e,isLoading:t,isAuthenticated:r}=(0,a.aC)(),[l,s]=(0,n.useState)("");return(0,o.jsx)("div",{className:"p-8",children:"This page is only available in development mode."})}},3227:function(e,t,r){"use strict";var o=r(3464),a=r(1290);let n="http://localhost:8000",l=o.Z.create({baseURL:n,headers:{"Content-Type":"application/json"},timeout:3e4}),s=!1,c=[],i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c.forEach(r=>{e?r.reject(e):r.resolve(t)}),c=[]},u=()=>{let e=window.location.pathname.split("/").filter(Boolean);return["en","es","fr","ru","uk","hy"].includes(e[0])?e[0]:"en"};l.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");if(t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e.headers){let t=u();e.headers["Accept-Language"]=t}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!r._retry){let e=localStorage.getItem("refresh_token");if(e){if(s)return new Promise((e,t)=>{c.push({resolve:e,reject:t})}).then(e=>(r.headers&&(r.headers.Authorization="Bearer ".concat(e)),l(r))).catch(e=>Promise.reject(e));r._retry=!0,s=!0;try{let{access:t}=(await o.Z.post("".concat(n).concat(a.q.AUTH.REFRESH),{refresh:e})).data;return localStorage.setItem("access_token",t),r.headers&&(r.headers.Authorization="Bearer ".concat(t)),i(null,t),s=!1,l(r)}catch(e){i(e,null),s=!1;{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}return Promise.reject(e)}}else{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}}return Promise.reject(e)}),t.ZP=l},1290:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});let o={AUTH:{TOKEN:"/api/auth/token/",REFRESH:"/api/auth/token/refresh/",ME:"/api/auth/me/"},CLINICAL:{APPOINTMENTS:"/api/v1/clinical/appointments/",PATIENTS:"/api/v1/clinical/patients/",ENCOUNTERS:"/api/v1/clinical/encounters/",TREATMENTS:"/api/v1/clinical/treatments/",PROPOSALS:"/api/v1/clinical/proposals/"},POS:{SALES:"/api/v1/pos/sales/"}}},7766:function(e,t,r){"use strict";r.d(t,{Ho:function(){return i},K$:function(){return m},aC:function(){return u},p5:function(){return d}});var o=r(7437),a=r(2265),n=r(9376),l=r(3227),s=r(1290);let c=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),m=(0,n.useRouter)();(0,a.useEffect)(()=>{(async()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("access_token");if(e&&t)try{let t=JSON.parse(e);i(t);try{let e=(await l.ZP.get(s.q.AUTH.ME)).data;localStorage.setItem("user",JSON.stringify(e)),i(e)}catch(e){console.error("Failed to refresh user profile:",e)}}catch(e){console.error("Failed to parse stored user:",e),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}d(!1)})()},[]);let h=async(e,t)=>{try{let{access:r,refresh:o}=(await l.ZP.post(s.q.AUTH.TOKEN,{email:e,password:t})).data;if(!r||!o)throw Error("Invalid token response from server");localStorage.setItem("access_token",r),localStorage.setItem("refresh_token",o);let a=(await l.ZP.get(s.q.AUTH.ME)).data;localStorage.setItem("user",JSON.stringify(a)),i(a)}catch(e){var r,o,a,n,c;throw localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null),Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.detail)||(null===(c=e.response)||void 0===c?void 0:null===(n=c.data)||void 0===n?void 0:null===(a=n.error)||void 0===a?void 0:a.message)||"Login failed. Please check your credentials.")}},v=e=>{var t,o;return null!==(o=null==r?void 0:null===(t=r.roles)||void 0===t?void 0:t.includes(e))&&void 0!==o&&o};return(0,o.jsx)(c.Provider,{value:{user:r,isLoading:u,isAuthenticated:!!r,login:h,logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null);let e=window.location.pathname.split("/")[1]||"en";m.push("/".concat(e,"/login"))},hasRole:v,hasAnyRole:e=>e.some(e=>v(e))},children:t})}function u(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{hasAnyRole:t}=u();return t(e)}let m={ADMIN:"admin",PRACTITIONER:"practitioner",RECEPTION:"reception",MARKETING:"marketing",ACCOUNTING:"accounting"}}},function(e){e.O(0,[301,971,117,744],function(){return e(e.s=2513)}),_N_E=e.O()}]);