(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{5272:function(e,t,o){Promise.resolve().then(o.bind(o,6287))},6287:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var r=o(7437),a=o(7766),n=o(2265),l=o(9376),s=o(2586),c=o(1848);function i(){let{login:e,isAuthenticated:t}=(0,a.aC)(),o=(0,l.useRouter)(),i=(0,s.useLocale)(),[u,d]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),[p,g]=(0,n.useState)(""),[v,f]=(0,n.useState)(!1);if(t)return o.push(c._.agenda(i)),null;let S=async t=>{t.preventDefault(),g(""),f(!0),console.log("[Login] Attempting login with:",u);try{await e(u,m),console.log("[Login] Success! Redirecting to:","/".concat(i)),o.push("/".concat(i))}catch(e){console.error("[Login] Error:",e),g(e.message||"Invalid credentials")}finally{f(!1)}};return(0,r.jsx)("div",{className:"login-page",children:(0,r.jsxs)("div",{className:"login-card",children:[(0,r.jsxs)("div",{className:"login-header",children:[(0,r.jsx)("h1",{children:"Cosmetica 5"}),(0,r.jsx)("p",{children:"Sistema de gesti\xf3n cl\xednico y de ventas"})]}),(0,r.jsxs)("form",{onSubmit:S,className:"login-form",children:[p&&(0,r.jsx)("div",{className:"alert-error",role:"alert",children:p}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"email",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",value:u,onChange:e=>d(e.target.value),required:!0,autoComplete:"email",autoFocus:!0,placeholder:"usuario@ejemplo.com"})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{htmlFor:"password",children:"Password"}),(0,r.jsx)("input",{id:"password",type:"password",value:m,onChange:e=>h(e.target.value),required:!0,autoComplete:"current-password",placeholder:"••••••••"})]}),(0,r.jsx)("button",{type:"submit",className:"btn-primary w-full",disabled:v,children:v?"Logging in...":"Login"})]})]})})}},3227:function(e,t,o){"use strict";var r=o(3464),a=o(1290);let n="http://localhost:8000",l=r.Z.create({baseURL:n,headers:{"Content-Type":"application/json"},timeout:3e4}),s=!1,c=[],i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;c.forEach(o=>{e?o.reject(e):o.resolve(t)}),c=[]},u=()=>{let e=window.location.pathname.split("/").filter(Boolean);return["en","es","fr","ru","uk","hy"].includes(e[0])?e[0]:"en"};l.interceptors.request.use(e=>{let t=localStorage.getItem("access_token");if(t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e.headers){let t=u();e.headers["Accept-Language"]=t}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t;let o=e.config;if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!o._retry){let e=localStorage.getItem("refresh_token");if(e){if(s)return new Promise((e,t)=>{c.push({resolve:e,reject:t})}).then(e=>(o.headers&&(o.headers.Authorization="Bearer ".concat(e)),l(o))).catch(e=>Promise.reject(e));o._retry=!0,s=!0;try{let{access:t}=(await r.Z.post("".concat(n).concat(a.q.AUTH.REFRESH),{refresh:e})).data;return localStorage.setItem("access_token",t),o.headers&&(o.headers.Authorization="Bearer ".concat(t)),i(null,t),s=!1,l(o)}catch(e){i(e,null),s=!1;{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}return Promise.reject(e)}}else{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user");let e=u();window.location.href="/".concat(e,"/login")}}return Promise.reject(e)}),t.ZP=l},1290:function(e,t,o){"use strict";o.d(t,{q:function(){return r}});let r={AUTH:{TOKEN:"/api/auth/token/",REFRESH:"/api/auth/token/refresh/",ME:"/api/auth/me/"},CLINICAL:{APPOINTMENTS:"/api/v1/clinical/appointments/",PATIENTS:"/api/v1/clinical/patients/",ENCOUNTERS:"/api/v1/clinical/encounters/",TREATMENTS:"/api/v1/clinical/treatments/",PROPOSALS:"/api/v1/clinical/proposals/"},POS:{SALES:"/api/v1/pos/sales/"}}},7766:function(e,t,o){"use strict";o.d(t,{Ho:function(){return i},K$:function(){return m},aC:function(){return u},p5:function(){return d}});var r=o(7437),a=o(2265),n=o(9376),l=o(3227),s=o(1290);let c=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[o,i]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),m=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("access_token");if(e&&t)try{let t=JSON.parse(e);i(t)}catch(e){console.error("Failed to parse stored user:",e),localStorage.removeItem("user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}d(!1)},[]);let h=async(e,t)=>{try{let{access:o,refresh:r}=(await l.ZP.post(s.q.AUTH.TOKEN,{email:e,password:t})).data;if(!o||!r)throw Error("Invalid token response from server");localStorage.setItem("access_token",o),localStorage.setItem("refresh_token",r);let a=(await l.ZP.get(s.q.AUTH.ME)).data;localStorage.setItem("user",JSON.stringify(a)),i(a)}catch(e){var o,r,a,n,c;throw localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null),Error((null===(r=e.response)||void 0===r?void 0:null===(o=r.data)||void 0===o?void 0:o.detail)||(null===(c=e.response)||void 0===c?void 0:null===(n=c.data)||void 0===n?void 0:null===(a=n.error)||void 0===a?void 0:a.message)||"Login failed. Please check your credentials.")}},p=e=>{var t,r;return null!==(r=null==o?void 0:null===(t=o.roles)||void 0===t?void 0:t.includes(e))&&void 0!==r&&r};return(0,r.jsx)(c.Provider,{value:{user:o,isLoading:u,isAuthenticated:!!o,login:h,logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),i(null);let e=window.location.pathname.split("/")[1]||"en";m.push("/".concat(e,"/login"))},hasRole:p,hasAnyRole:e=>e.some(e=>p(e))},children:t})}function u(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{hasAnyRole:t}=u();return t(e)}let m={ADMIN:"admin",PRACTITIONER:"practitioner",RECEPTION:"reception",MARKETING:"marketing",ACCOUNTING:"accounting"}},1848:function(e,t,o){"use strict";o.d(t,{_:function(){return r}});let r={dashboard:e=>"/".concat(e),agenda:e=>"/".concat(e),encounters:{list:e=>"/".concat(e,"/encounters"),detail:(e,t)=>"/".concat(e,"/encounters/").concat(t)},proposals:{list:e=>"/".concat(e,"/proposals")},login:e=>"/".concat(e,"/login"),patients:{list:e=>"/".concat(e,"/patients"),detail:(e,t)=>"/".concat(e,"/patients/").concat(t)},sales:{list:e=>"/".concat(e,"/sales")},admin:e=>"/".concat(e,"/admin")}}},function(e){e.O(0,[618,586,971,117,744],function(){return e(e.s=5272)}),_N_E=e.O()}]);